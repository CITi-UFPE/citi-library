- pipeline: "Build and deploy"
  trigger_mode: "ON_EVERY_PUSH"
  ref_name: "master"
  ref_type: "BRANCH"
  actions:
  - action: "Execute: npm install"
    type: "BUILD"
    working_directory: "/buddy/citi-library"
    docker_image_name: "library/node"
    docker_image_tag: "latest"
    execute_commands:
    - "npm install"
    - "npm run build"
    setup_commands:
    - "npm install -g gulp grunt-cli"
    mount_filesystem_path: "/buddy/citi-library"
    shell: "BASH"
    trigger_condition: "ALWAYS"
  - action: "Upload files to citi.org.br"
    type: "SFTP"
    input_type: "BUILD_ARTIFACTS"
    local_path: "build/"
    remote_path: "/home/citi/webapps/discord_library/"
    login: "citi"
    password: "SENHA_AQUI"
    host: "citi.org.br"
    port: "22"
    authentication_mode: "PASS"
  - action: "[citi.org.br] Execute: forever restart server.js"
    type: "SSH_COMMAND"
    working_directory: "/home/citi/webapps/discord_library/"
    login: "citi"
    password: "SENHA_AQUI"
    host: "citi.org.br"
    port: "22"
    authentication_mode: "PASS"
    commands:
    - "export PATH=$HOME/webapps/discord_library/bin:$PATH"
    - "npm install -g forever"
    - "forever restart server.js"
    trigger_condition_paths:
    - "src/"
    - "public/"
    run_as_script: true
    shell: "BASH"
    trigger_condition: "ON_CHANGE_AT_PATH"
  - action: "Send notification to Discord"
    type: "DISCORD"
    local_path: "/"
    notification_url: "https://discordapp.com/api/webhooks/492178921014427648/8YGy-VsaL2sGBlVCJtgE0gAfvAdl7T4xBhjId92T1yNiuyBOzGE6DXkClI6wcpN7JUeK"
    content: "[#$BUDDY_EXECUTION_ID] $BUDDY_PIPELINE_NAME by $BUDDY_INVOKER_NAME"
    embeds: "[{\"title\":\"Details\",\"url\":\"$BUDDY_EXECUTION_URL\",\"fields\":[{\"name\":\"Status\",\"value\":\"Successful execution\"},{\"name\":\"Revision\",\"value\":\"$BUDDY_EXECUTION_REVISION\"},{\"name\":\"Pipeline\",\"value\":\"$BUDDY_PIPELINE_NAME\"},{\"name\":\"Project\",\"value\":\"$BUDDY_PROJECT_NAME\"}]}]"
    trigger_condition: "ALWAYS"
